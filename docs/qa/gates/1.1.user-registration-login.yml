# <!-- Powered by BMADâ„¢ Core -->
template:
  id: qa-gate-template-v1
  name: Quality Gate Decision
  version: 1.0
  output:
    format: yaml
    filename: qa.qaLocation/gates/1.1.user-registration-login.yml
    title: "Quality Gate: 1.1"

# Required fields (keep these first)
schema: 1
story: "1.1"
story_title: "User Registration & Login"
gate: "CONCERNS" # PASS|CONCERNS|FAIL|WAIVED
status_reason: "Missing middleware integration tests and absence of a defined project-wide testing strategy." # 1-2 sentence summary of why this gate decision
reviewer: "Quinn (Test Architect)"
updated: "2025-08-28T00:00:00Z"

# Always present but only active when WAIVED
waiver: { active: false }

# Issues (if any) - Use fixed severity: low | medium | high
top_issues:
  - id: "TEST-001"
    severity: high
    finding: "Missing integration tests for protected route middleware (`middleware.ts`)."
    suggested_action: "Create `apps/web/middleware.test.ts` to thoroughly test protected route functionality and redirection."
  - id: "TEST-002"
    severity: medium
    finding: "No explicit end-to-end (E2E) tests for the full user registration and login flow."
    suggested_action: "Introduce E2E tests (e.g., using Playwright or Cypress) to cover the complete user journey."
  - id: "DOC-001"
    severity: medium
    finding: "Absence of a defined project-wide testing strategy document (`docs/architecture/testing-strategy.md`)."
    suggested_action: "Create `docs/architecture/testing-strategy.md` to formalize the project's testing approach."
  - id: "NFR-001"
    severity: low
    finding: "Incomplete non-functional requirements (NFRs) testing (security, performance, usability)."
    suggested_action: "Conduct a security review, consider basic load testing for API endpoints, and perform a quick usability review of the forms."

# Risk summary (from risk-profile task if run)
risk_summary:
  totals: { critical: 0, high: 1, medium: 2, low: 1 }
  recommendations:
    must_fix:
      - "Implement Middleware Integration Tests"
    monitor:
      - "Introduce E2E Tests"
      - "Develop a Project Testing Strategy"
      - "Address NFR Testing"

# Examples section using block scalars for clarity
examples:
  with_issues: |
    top_issues:
      - id: "SEC-001"
        severity: high  # ONLY: low|medium|high
        finding: "No rate limiting on login endpoint"
        suggested_action: "Add rate limiting middleware before production"
      - id: "TEST-001"  
        severity: medium
        finding: "Missing integration tests for auth flow"
        suggested_action: "Add test coverage for critical paths"

  when_waived: |
    waiver:
      active: true
      reason: "Accepted for MVP release - will address in next sprint"
      approved_by: "Product Owner"

# ============ Optional Extended Fields ============
# Uncomment and use if your team wants more detail

optional_fields_examples:
  quality_and_expiry: |
    quality_score: 75  # 0-100 (optional scoring)
    expires: "2025-01-26T00:00:00Z"  # Optional gate freshness window

  evidence: |
    evidence:
      tests_reviewed: 15
      risks_identified: 3
      trace:
        ac_covered: [1, 2, 3]  # AC numbers with test coverage
        ac_gaps: [4]  # AC numbers lacking coverage

  nfr_validation: |
    nfr_validation:
      security: { status: CONCERNS, notes: "Rate limiting missing" }
      performance: { status: PASS, notes: "" }
      reliability: { status: PASS, notes: "" }
      maintainability: { status: PASS, notes: "" }

  history: |
    history:  # Append-only audit trail
      - at: "2025-01-12T10:00:00Z"
        gate: FAIL
        note: "Initial review - missing tests"
      - at: "2025-01-12T15:00:00Z"  
        gate: CONCERNS
        note: "Tests added but rate limiting still missing"

  risk_summary: |
    risk_summary:  # From risk-profile task
      totals:
        critical: 0
        high: 0
        medium: 0
        low: 0
      # 'highest' is emitted only when risks exist
      recommendations:
        must_fix: []
        monitor: []

  recommendations: |
    recommendations:
      immediate:  # Must fix before production
        - action: "Add rate limiting to auth endpoints"
          refs: ["api/auth/login.ts:42-68"]
      future:  # Can be addressed later
        - action: "Consider caching for better performance"
          refs: ["services/data.service.ts"]
